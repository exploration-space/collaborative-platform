language: python
python:
  - "3.8"

services:
  - postgresql

before_install:
  - openssl aes-256-cbc -K $encrypted_1443f6b77812_key -iv $encrypted_1443f6b77812_iv
    -in providedh-key.enc -out providedh-key -d
  - chmod 600 providedh-key

install:
  - pip install -r requirements.txt
  - pip install src/collaborative_platform


script: cd src/collaborative_platform && pytest

deploy:
  skip_cleanup: true
  provider: script
  script: ssh -o "StrictHostKeyChecking no" ubuntu@providedh-test.ehum.psnc.pl -i providedh-key "cd collaborative-platform && ./prod_upgrade"
  on:
    branch: develop